<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Game with Drag-and-Drop Reorder</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background-color: black;
      color: #FAFAFA;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      height: 100vh;
      text-align: center;
    }

    h1 {
      margin-top: 1rem;
    }

    #topButtons {
      margin-top: 1rem;
    }
    button {
      font-size: 1.2rem;
      padding: 0.5rem 1rem;
      cursor: pointer;
      border: none;
      border-radius: 4px;
      background: #007BFF;
      color: white;
      transition: background 0.3s;
      margin: 0.5rem;
    }
    button:hover {
      background: #0056b3;
    }

    /* Current sign with stroke effect */
    #sign {
      margin-top: 2rem;
      font-size: 1.5rem;
      font-weight: bold;
      color: #fff;
      text-shadow:
        -1px 0 red,
         1px 0 red,
         0 -1px red,
         0  1px red;
      -webkit-text-stroke: 1px red;
      -webkit-text-fill-color: #fff;
      min-height: 2em; /* reserve space even when empty */
    }

    /* Container for the 4 signs that have played */
    #playedSigns {
      margin-top: 2rem;
      width: 80%;
      margin-left: auto;
      margin-right: auto;
      text-align: center;
    }
    #playedSigns p {
      margin: 0.5rem 0;
      color: #FAFAFA;
      font-size: 1.2rem;
    }

    /* Radio buttons */
    #choiceContainer {
      margin-top: 2rem;
    }
    .choiceItem {
      margin: 0.5rem 0;
      display: block; /* each choice on its own line */
    }
    label {
      cursor: pointer;
    }

    /* Reorder section (drag-and-drop) */
    #reorderContainer {
      margin-top: 2rem;
      width: 80%;
      margin-left: auto;
      margin-right: auto;
      text-align: left; /* so items align more naturally */
      display: none;    /* hidden until needed */
    }

    #reorderContainer h2 {
      text-align: center;
      margin-bottom: 1rem;
    }

    .draggableItem {
      background-color: #222;
      margin: 0.3rem 0;
      padding: 0.5rem;
      border: 1px solid #888;
      cursor: move;
    }

    .dragOver {
      outline: 2px dashed #fff;
    }
  </style>
</head>
<body>
  <h1>Listen and Watch the Screen</h1>

  <!-- Top button: Restart Game -->
  <div id="topButtons">
    <button id="restartBtn">Restart Game</button>
  </div>

  <!-- Current sign with stroke effect (while playing) -->
  <div id="sign"></div>

  <!-- Container for the 4 signs that have been played -->
  <div id="playedSigns"></div>

  <!-- Container for radio buttons + Submit (appears after 4 audio clips) -->
  <div id="choiceContainer"></div>

  <!-- Drag-and-drop reorder container (shown after user picks radio) -->
  <div id="reorderContainer">
    <h2>Reorder Your 4 Signs</h2>
    <!-- We'll dynamically insert the items. -->
    <!-- Then a "Submit Order" button -->
    <button id="submitOrderBtn">Submit Order</button>
  </div>

  <!-- Single audio element -->
  <audio id="audioElement"></audio>

  <script>
    // ========== DATA ==========
    const possibleSigns = [
      "That is embarrassing",
      "that isn’t my receipt",
      "lactates in pharmacy",
      "baptism piracy",
      "that isn’t parsley",
      "bart simpson bouncing",
      "rats eating pirate shit",
      "five, six, six, five or six",
      "that isn’t bouncing",
      "nazis in pirate ships",
      "that isn’t piracy",
      "Battles and Parasites"
    ];

    const audioPlaylist = [
      "audio/clip1.mp3",
      "audio/clip2.mp3",
      "audio/clip3.mp3",
      "audio/clip4.mp3"
    ];

    // ========== ELEMENTS ==========
    const restartBtn          = document.getElementById("restartBtn");
    const audioEl             = document.getElementById("audioElement");
    const signEl              = document.getElementById("sign");
    const playedSignsContainer = document.getElementById("playedSigns");
    const choiceContainer     = document.getElementById("choiceContainer");
    const reorderContainer    = document.getElementById("reorderContainer");
    const submitOrderBtn      = document.getElementById("submitOrderBtn");

    // ========== STATE ==========
    let chosenSignIndexes = [];  // the 4 unique random indices from possibleSigns
    let currentIndex      = 0;   // which audio track is playing
    let userSelectionIndex = null;  // the chosen sign's original index
    let reorderArray      = [];  // for drag-and-drop (stores the 4 chosen indices in the final reorder)

    // ========== UTILITY: shuffle in place ==========
    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    // ========== START NEW GAME ==========
    function startNewGame() {
      audioEl.pause();
      audioEl.currentTime = 0;

      // Clear / reset everything
      playedSignsContainer.innerHTML = "";
      choiceContainer.innerHTML      = "";
      reorderContainer.style.display = "none";
      signEl.textContent            = "";
      chosenSignIndexes             = [];
      currentIndex                  = 0;
      userSelectionIndex            = null;
      reorderArray                  = [];

      // Pick 4 random sign indexes
      chosenSignIndexes = pick4RandomSignIndexes();

      // Load the first track and play
      loadTrack(currentIndex);
      audioEl.play();
    }

    function pick4RandomSignIndexes() {
      const indices = Array.from({length: possibleSigns.length}, (_,i) => i);
      shuffleArray(indices);
      return indices.slice(0, 4);
    }

    function loadTrack(index) {
      if (index < audioPlaylist.length) {
        audioEl.src = audioPlaylist[index];
        const signIdx = chosenSignIndexes[index];
        signEl.textContent = possibleSigns[signIdx]; // stroke effect area
      } else {
        audioEl.src = "";
        signEl.textContent = "";
      }
    }

    // ========== AUDIO EVENT: ended ==========
    audioEl.addEventListener("ended", () => {
      // Just-played sign
      const playedSignIndex = chosenSignIndexes[currentIndex];
      const playedSignText  = possibleSigns[playedSignIndex];
      // Append to #playedSigns
      const p = document.createElement("p");
      p.textContent = playedSignText;
      playedSignsContainer.appendChild(p);

      currentIndex++;
      if (currentIndex < audioPlaylist.length) {
        loadTrack(currentIndex);
        audioEl.play();
      } else {
        // All 4 done
        signEl.textContent = "";
        // Show radio button choices
        createRadioButtonsAndSubmit();
      }
    });

    // ========== CREATE RADIO BUTTONS ==========
    function createRadioButtonsAndSubmit() {
      choiceContainer.innerHTML = "";

      const info = document.createElement("p");
      info.textContent = "Choose exactly one of the 4 displayed signs:";
      choiceContainer.appendChild(info);

      // We'll create a radio for each of the chosenSignIndexes
      chosenSignIndexes.forEach((signIdx, i) => {
        const signText = possibleSigns[signIdx];

        const div = document.createElement("div");
        div.classList.add("choiceItem");

        const input = document.createElement("input");
        input.type = "radio";
        input.name = "signSelection";
        input.id   = `signOption${i}`;
        // store the original index in the value
        input.value = signIdx;

        const label = document.createElement("label");
        label.htmlFor = input.id;
        label.textContent = signText;

        div.appendChild(input);
        div.appendChild(label);
        choiceContainer.appendChild(div);
      });

      // Add a "Submit" button
      const submitBtn = document.createElement("button");
      submitBtn.textContent = "Submit";
      submitBtn.addEventListener("click", onSubmitChoice);
      choiceContainer.appendChild(submitBtn);
    }

    // ========== RADIO SUBMIT HANDLER ==========
    function onSubmitChoice() {
      const selectedRadio = document.querySelector("input[name='signSelection']:checked");
      if (!selectedRadio) {
        alert("Please select one of the options first.");
        return;
      }

      userSelectionIndex = parseInt(selectedRadio.value, 10);
      // We have the user's chosen sign index from possibleSigns
      // Now we enable the reorder step:

      // Hide the radio UI
      choiceContainer.innerHTML = "";
      // Show drag-and-drop reorder
      showReorderUI();
    }

    // ========== SHOW DRAG-AND-DROP UI ==========
    function showReorderUI() {
      reorderContainer.style.display = "block";

      // We'll start reorderArray with the same order as chosenSignIndexes
      // (You could re-shuffle them if you want a random initial order.)
      reorderArray = [...chosenSignIndexes];

      // Render them as draggable items
      renderReorderList();
    }

    // ========== RENDER THE DRAGGABLE LIST ==========
    function renderReorderList() {
      // We'll insert them right before the "Submit Order" button
      // So let's temporarily remove the button, re-insert after items
      const submitBtn = document.getElementById("submitOrderBtn");
      reorderContainer.innerHTML = '<h2>Reorder Your 4 Signs</h2>';
      reorderContainer.appendChild(submitBtn);

      reorderArray.forEach((signIdx, i) => {
        const signText = possibleSigns[signIdx];
        const div = document.createElement("div");
        div.classList.add("draggableItem");
        div.textContent = signText;
        div.setAttribute("draggable", "true");
        // We'll store the position in a data attribute
        div.dataset.position = i;

        // DRAG EVENT: start
        div.addEventListener("dragstart", handleDragStart);
        // DRAG EVENT: end
        div.addEventListener("dragend", handleDragEnd);
        // DRAG EVENT: over
        div.addEventListener("dragover", handleDragOver);
        // DRAG EVENT: drop
        div.addEventListener("drop", handleDrop);

        // Insert it above the "Submit Order" button
        reorderContainer.insertBefore(div, submitBtn);
      });
    }

    // We'll track the index of the item being dragged
    let dragSrcIndex = null;

    function handleDragStart(e) {
      // 'this' is the dragged item
      dragSrcIndex = parseInt(this.dataset.position, 10);
      // Some browsers need setData, even if empty
      e.dataTransfer.effectAllowed = "move";
      e.dataTransfer.setData("text/plain", ""); 
      // Add a class if you want styling
      this.classList.add("dragging");
    }

    function handleDragEnd() {
      this.classList.remove("dragging");
    }

    function handleDragOver(e) {
      e.preventDefault(); // allow drop
      this.classList.add("dragOver");
    }

    function handleDrop(e) {
      e.preventDefault();
      this.classList.remove("dragOver");

      const dropTargetIndex = parseInt(this.dataset.position, 10);

      // Reorder the array: move the item at dragSrcIndex to dropTargetIndex
      if (dragSrcIndex !== dropTargetIndex) {
        // Remove the item from old position
        const movedItem = reorderArray.splice(dragSrcIndex, 1)[0];
        // Insert it into the new position
        reorderArray.splice(dropTargetIndex, 0, movedItem);
        // Re-render
        renderReorderList();
      }
    }

    // ========== SUBMIT ORDER BUTTON ==========
    submitOrderBtn.addEventListener("click", () => {
      // reorderArray now holds the final order of the *4 chosen indices*
      // We'll open a new page and display them
      openResultPage();
    });

    function openResultPage() {
      // Create a new tab/window
      const newWin = window.open("", "_blank");
      // Build some HTML to display the final order
      newWin.document.write("<html><head><title>Final Order</title></head><body style='font-family:sans-serif;'>");
      newWin.document.write("<h2>Here is your final reordered list:</h2>");
      newWin.document.write("<ol>");

      reorderArray.forEach(idx => {
        newWin.document.write("<li>" + possibleSigns[idx] + "</li>");
      });

      newWin.document.write("</ol>");

      newWin.document.write("<hr><p>You had initially selected index: " + userSelectionIndex + "<br/>");
      newWin.document.write("which is \"" + possibleSigns[userSelectionIndex] + "\".</p>");

      newWin.document.write("</body></html>");
      newWin.document.close();
    }

    // ========== RESTART BUTTON CLICK ==========
    restartBtn.addEventListener("click", startNewGame);
  </script>
</body>
</html>
