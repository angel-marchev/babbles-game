<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Game with Single Restart and Radio Choice</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background-color: black;
      color: #FAFAFA;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      height: 100vh;
      text-align: center;
    }

    h1 {
      margin-top: 1rem;
    }

    /* Top button container */
    #topButtons {
      margin-top: 1rem;
    }

    button {
      font-size: 1.2rem;
      padding: 0.5rem 1rem;
      cursor: pointer;
      border: none;
      border-radius: 4px;
      background: #007BFF;
      color: white;
      transition: background 0.3s;
      margin: 0.5rem;
    }
    button:hover {
      background: #0056b3;
    }

    /* Current sign with stroke effect */
    #sign {
      margin-top: 2rem;
      font-size: 1.5rem;
      font-weight: bold;
      color: #fff;
      text-shadow:
        -1px 0 red,
         1px 0 red,
         0 -1px red,
         0  1px red;
      -webkit-text-stroke: 1px red;
      -webkit-text-fill-color: #fff;
      min-height: 2em; /* reserve space even when empty */
    }

    /* Container for played signs */
    #playedSigns {
      margin-top: 2rem;
      width: 80%;
      margin-left: auto;
      margin-right: auto;
      text-align: center;
    }
    #playedSigns p {
      margin: 0.5rem 0;
      color: #FAFAFA;
      font-size: 1.2rem;
    }

    /* Radio buttons and Submit */
    #choiceContainer {
      margin-top: 2rem;
    }
    .choiceItem {
      margin: 0.5rem 0;
      display: block; /* each choice on its own line */
    }
    label {
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>Listen and Watch the Screen</h1>

  <!-- Top button: Restart Game -->
  <div id="topButtons">
    <button id="restartBtn">Restart Game</button>
  </div>

  <!-- Current sign with stroke effect -->
  <div id="sign"></div>

  <!-- Container for played signs in plain text -->
  <div id="playedSigns"></div>

  <!-- Container for radio buttons and the Submit button -->
  <div id="choiceContainer"></div>

  <!-- Single audio element -->
  <audio id="audioElement"></audio>

  <script>
    // -------- DATA --------
    // The master list of possible signs (text strings)
    const possibleSigns = [
      "That is embarrassing",
      "that isn’t my receipt",
      "lactates in pharmacy",
      "baptism piracy",
      "that isn’t parsley",
      "bart simpson bouncing",
      "rats eating pirate shit",
      "five, six, six, five or six",
      "that isn’t bouncing",
      "nazis in pirate ships",
      "that isn’t piracy",
      "Battles and Parasites"
    ];

    // Audio playlist (4 clips to play in order)
    const audioPlaylist = [
      "audio/clip1.mp3",
      "audio/clip2.mp3",
      "audio/clip3.mp3",
      "audio/clip4.mp3"
    ];

    // -------- ELEMENTS --------
    const audioEl             = document.getElementById("audioElement");
    const signEl              = document.getElementById("sign");
    const playedSignsContainer = document.getElementById("playedSigns");
    const choiceContainer     = document.getElementById("choiceContainer");
    const restartBtn          = document.getElementById("restartBtn");

    // -------- STATE --------
    // We'll store the 4 chosen *original indices* from the possibleSigns array.
    // Then we can quickly get the text, and also store that index if selected by the user.
    let chosenSignIndexes = [];
    let currentIndex      = 0;  // Which audio clip is playing
    let userSelectionIndex = null; // We'll store the user's chosen index

    // -------- UTILITY: Shuffle an array in place (Fisher-Yates) --------
    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
      return arr;
    }

    // -------- GAME LOGIC --------

    // 1) Start a brand new game
    function startNewGame() {
      // Stop any current audio
      audioEl.pause();
      audioEl.currentTime = 0;

      // Clear containers, indexes, etc.
      playedSignsContainer.innerHTML = "";
      choiceContainer.innerHTML      = "";
      signEl.textContent            = "";
      chosenSignIndexes             = [];
      currentIndex                  = 0;
      userSelectionIndex            = null;

      // Choose 4 random indices from possibleSigns
      chosenSignIndexes = pick4RandomSignIndexes();

      // Load the first audio clip and start playing
      loadTrack(currentIndex);
      audioEl.play();
    }

    // 2) Return an array of 4 unique random indices
    function pick4RandomSignIndexes() {
      // All indexes [0, 1, ..., N-1]
      const allIndexes = Array.from({length: possibleSigns.length}, (_, i) => i);
      shuffleArray(allIndexes);

      // Take first 4
      return allIndexes.slice(0, 4);
    }

    // 3) Load a track by index and set the stroke-text sign
    function loadTrack(index) {
      if (index < audioPlaylist.length) {
        audioEl.src = audioPlaylist[index];
        const signIdx = chosenSignIndexes[index];
        signEl.textContent = possibleSigns[signIdx]; // show text with stroke effect
      } else {
        audioEl.src = "";
        signEl.textContent = "";
      }
    }

    // 4) On each clip end: show plain text in #playedSigns, then move to next
    audioEl.addEventListener("ended", () => {
      // Just-played sign
      const playedSignIdx = chosenSignIndexes[currentIndex];
      const playedSignText = possibleSigns[playedSignIdx];

      // Append to the #playedSigns container
      const p = document.createElement("p");
      p.textContent = playedSignText;
      playedSignsContainer.appendChild(p);

      // Move on
      currentIndex++;
      if (currentIndex < audioPlaylist.length) {
        loadTrack(currentIndex);
        audioEl.play();
      } else {
        // All four have played, so show radio buttons
        signEl.textContent = "";
        createRadioButtonsAndSubmit();
      }
    });

    // 5) If user manually pauses (e.g. through browser controls), let them resume
    audioEl.addEventListener("pause", () => {
      // do nothing special, or re-enable a "Play" if you had one.
      // but we've removed the Play button, so this is optional
    });

    // 6) Build radio buttons + "Submit" after the last sign
    function createRadioButtonsAndSubmit() {
      choiceContainer.innerHTML = ""; // clear just in case

      // Add instructions
      const info = document.createElement("p");
      info.textContent = "Choose exactly one of the 4 displayed signs:";
      choiceContainer.appendChild(info);

      // Create a container for the radio items
      chosenSignIndexes.forEach((signIdx, i) => {
        const signText = possibleSigns[signIdx];

        // Each choice in a separate div
        const div = document.createElement("div");
        div.classList.add("choiceItem");

        const input = document.createElement("input");
        input.type = "radio";
        input.name = "signSelection";
        input.id = `signOption${i}`;
        // value = the *original index* in the possibleSigns
        input.value = signIdx;

        const label = document.createElement("label");
        label.htmlFor = input.id;
        label.textContent = signText;

        div.appendChild(input);
        div.appendChild(label);
        choiceContainer.appendChild(div);
      });

      // Create a "Submit" button
      const submitBtn = document.createElement("button");
      submitBtn.textContent = "Submit";
      submitBtn.addEventListener("click", onSubmitChoice);
      choiceContainer.appendChild(submitBtn);
    }

    // 7) On "Submit" click, store the *original index* the user picked
    function onSubmitChoice() {
      // Find which radio is selected
      const selectedRadio = document.querySelector("input[name='signSelection']:checked");
      if (!selectedRadio) {
        alert("Please select one of the options.");
        return;
      }

      // Convert string -> number
      userSelectionIndex = parseInt(selectedRadio.value, 10);

      // You can do anything you want with that index here
      console.log("User selected index in possibleSigns: ", userSelectionIndex);

      // For demonstration, maybe show a quick message
      alert(`You picked: "${possibleSigns[userSelectionIndex]}" (index ${userSelectionIndex})`);
    }

    // 8) Hook up the Restart button to start a new game
    restartBtn.addEventListener("click", startNewGame);
  </script>
</body>
</html>
